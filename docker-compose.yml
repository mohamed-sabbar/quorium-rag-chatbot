services:
  backend:
    build:
      context: ./backend  # Build Docker image using the Dockerfile located in ./backend
    container_name: rag_backend # Name of the backend container
    volumes:
      - ./backend/data:/app/data # Mount local 'data' folder to container for persistent documents
      - ./backend/vector_store:/app/vector_store # Mount local vector store for persistence
    environment:
      - VECTOR_STORE_PATH=/app/vector_store # Path inside container for vector store
      - DOCS_PATH=/app/data/docs  # Path inside container for source documents
      - GROQ_API_KEY=${GROQ_API_KEY:-}     # Groq API key read from environment (empty if not set)
    ports:
      - "8000:8000"  # Map host port 8000 to container port 8000 (FastAPI)
    stdin_open: true # Keep STDIN open for interactive sessions
    tty: true        # Allocate a pseudo-TTY for the container
  frontend:
    build:
      context: ./frontend  # Build Docker image using Dockerfile in ./frontend
    container_name: rag_frontend # Name of the frontend container
    ports:
      - "3000:3000" # Map host port 3000 to container port 3000 (Next.js or React dev server)
    stdin_open: true  # Keep STDIN open
    tty: true         # Allocate a pseudo-TTY
    environment:
      - NEXT_PUBLIC_API_URL=http://backend:8000  # Frontend communicates with backend via this URL
    depends_on:
      - backend  # Ensure the backend container is started before the frontend
